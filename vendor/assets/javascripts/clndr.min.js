(function(e,t,n,r){function u(t,n){this.element=t;this.options=e.extend(true,{},o,n);if(this.options.events.length){if(this.options.multiDayEvents){this.options.events=this.addMultiDayMomentObjectsToEvents(this.options.events)}else{this.options.events=this.addMomentObjectToEvents(this.options.events)}}if(this.options.startWithMonth){this.month=moment(this.options.startWithMonth).startOf("month")}else{this.month=moment().startOf("month")}if(this.options.constraints){if(this.options.constraints.startDate){var r=moment(this.options.constraints.startDate);if(this.month.isBefore(r,"month")){this.month.set("month",r.month());this.month.set("year",r.year())}}if(this.options.constraints.endDate){var i=moment(this.options.constraints.endDate);if(this.month.isAfter(i,"month")){this.month.set("month",i.month()).set("year",i.year())}}}this._defaults=o;this._name=s;this.init()}var i="<div class='clndr-controls'>"+"<div class='clndr-control-button'><span class='clndr-previous-button'>previous</span></div><div class='month'><%= month %> <%= year %></div><div class='clndr-control-button rightalign'><span class='clndr-next-button'>next</span></div>"+"</div>"+"<table class='clndr-table' border='0' cellspacing='0' cellpadding='0'>"+"<thead>"+"<tr class='header-days'>"+"<% for(var i = 0; i < daysOfTheWeek.length; i++) { %>"+"<td class='header-day'><%= daysOfTheWeek[i] %></td>"+"<% } %>"+"</tr>"+"</thead>"+"<tbody>"+"<% for(var i = 0; i < numberOfRows; i++){ %>"+"<tr>"+"<% for(var j = 0; j < 7; j++){ %>"+"<% var d = j + i * 7; %>"+"<td class='<%= days[d].classes %>'><div class='day-contents'><%= days[d].day %>"+"</div></td>"+"<% } %>"+"</tr>"+"<% } %>"+"</tbody>"+"</table>";var s="clndr";var o={template:i,weekOffset:0,startWithMonth:null,clickEvents:{click:null,nextMonth:null,previousMonth:null,nextYear:null,previousYear:null,today:null,onMonthChange:null,onYearChange:null},targets:{nextButton:"clndr-next-button",previousButton:"clndr-previous-button",nextYearButton:"clndr-next-year-button",previousYearButton:"clndr-previous-year-button",todayButton:"clndr-today-button",day:"day",empty:"empty"},events:[],extras:null,dateParameter:"date",multiDayEvents:null,doneRendering:null,render:null,daysOfTheWeek:null,showAdjacentMonths:true,adjacentDaysChangeMonth:false,ready:null,constraints:null,forceSixRows:null};u.prototype.init=function(){this.daysOfTheWeek=this.options.daysOfTheWeek||[];if(!this.options.daysOfTheWeek){this.daysOfTheWeek=[];for(var t=0;t<7;t++){this.daysOfTheWeek.push(moment().weekday(t).format("dd").charAt(0))}}if(this.options.weekOffset){this.daysOfTheWeek=this.shiftWeekdayLabels(this.options.weekOffset)}if(!e.isFunction(this.options.render)){this.options.render=null;if(typeof _==="undefined"){throw new Error("Underscore was not found. Please include underscore.js OR provide a custom render function.")}else{this.compiledClndrTemplate=_.template(this.options.template)}}e(this.element).html("<div class='clndr'></div>");this.calendarContainer=e(".clndr",this.element);this.bindEvents();this.render();if(this.options.ready){this.options.ready.apply(this,[])}};u.prototype.shiftWeekdayLabels=function(e){var t=this.daysOfTheWeek;for(var n=0;n<e;n++){t.push(t.shift())}return t};u.prototype.createDaysObject=function(t){daysArray=[];var n=t.startOf("month");this.eventsLastMonth=[];this.eventsThisMonth=[];this.eventsNextMonth=[];if(this.options.events.length){if(this.options.multiDayEvents){this.eventsThisMonth=e(this.options.events).filter(function(){return this._clndrStartDateObject.format("YYYY-MM")<=t.format("YYYY-MM")||t.format("YYYY-MM")<=this._clndrEndDateObject.format("YYYY-MM")}).toArray();if(this.options.showAdjacentMonths){var r=t.clone().subtract("months",1);var i=t.clone().add("months",1);this.eventsLastMonth=e(this.options.events).filter(function(){return this._clndrStartDateObject.format("YYYY-MM")<=r.format("YYYY-MM")||r.format("YYYY-MM")<=this._clndrEndDateObject.format("YYYY-MM")}).toArray();this.eventsNextMonth=e(this.options.events).filter(function(){return this._clndrStartDateObject.format("YYYY-MM")<=i.format("YYYY-MM")||i.format("YYYY-MM")<=this._clndrEndDateObject.format("YYYY-MM")}).toArray()}}else{this.eventsThisMonth=e(this.options.events).filter(function(){return this._clndrDateObject.format("YYYY-MM")==t.format("YYYY-MM")}).toArray();if(this.options.showAdjacentMonths){var r=t.clone().subtract("months",1);var i=t.clone().add("months",1);this.eventsLastMonth=e(this.options.events).filter(function(){return this._clndrDateObject.format("YYYY-MM")==r.format("YYYY-MM")}).toArray();this.eventsNextMonth=e(this.options.events).filter(function(){return this._clndrDateObject.format("YYYY-MM")==i.format("YYYY-MM")}).toArray()}}}var s=n.weekday()-this.options.weekOffset;if(s<0)s+=7;if(this.options.showAdjacentMonths){for(var o=0;o<s;o++){var u=moment([t.year(),t.month(),o-s+1]);daysArray.push(this.createDayObject(u,this.eventsLastMonth))}}else{for(var o=0;o<s;o++){daysArray.push(this.calendarDay({classes:this.options.targets.empty+" last-month"}))}}var a=n.daysInMonth();for(var o=1;o<=a;o++){var u=moment([t.year(),t.month(),o]);daysArray.push(this.createDayObject(u,this.eventsThisMonth))}var o=1;while(daysArray.length%7!==0){if(this.options.showAdjacentMonths){var u=moment([t.year(),t.month(),a+o]);daysArray.push(this.createDayObject(u,this.eventsNextMonth))}else{daysArray.push(this.calendarDay({classes:this.options.targets.empty+" next-month"}))}o++}if(this.options.forceSixRows&&daysArray.length!==42){var f=moment(daysArray[daysArray.length-1].date).add("days",1);while(daysArray.length<42){if(this.options.showAdjacentMonths){daysArray.push(this.createDayObject(moment(f),this.eventsNextMonth));f.add("days",1)}else{daysArray.push(this.calendarDay({classes:this.options.targets.empty+" next-month"}))}}}return daysArray};u.prototype.createDayObject=function(e,t){var n=[];var i=moment();var s=this;var o=0,u=t.length;for(o;o<u;o++){if(s.options.multiDayEvents){var a=t[o]._clndrStartDateObject;var f=t[o]._clndrEndDateObject;if((e.isSame(a,"day")||e.isAfter(a,"day"))&&(e.isSame(f,"day")||e.isBefore(f,"day"))){n.push(t[o])}}else{if(t[o]._clndrDateObject.date()==e.date()){n.push(t[o])}}}var l="";if(i.format("YYYY-MM-DD")==e.format("YYYY-MM-DD")){l+=" today"}if(e.isBefore(i,"day")){l+=" past"}if(n.length){l+=" event"}if(this.month.month()>e.month()){l+=" adjacent-month";this.month.year()===e.year()?l+=" last-month":l+=" next-month"}else if(this.month.month()<e.month()){l+=" adjacent-month";this.month.year()===e.year()?l+=" next-month":l+=" last-month"}if(this.options.constraints){if(this.options.constraints.startDate&&e.isBefore(moment(this.options.constraints.startDate))){l+=" inactive"}if(this.options.constraints.endDate&&e.isAfter(moment(this.options.constraints.endDate))){l+=" inactive"}}if(!e.isValid()&&e.hasOwnProperty("_d")&&e._d!=r){e=moment(e._d)}l+=" calendar-day-"+e.format("YYYY-MM-DD");l+=" calendar-dow-"+e.weekday();return this.calendarDay({day:e.date(),classes:this.options.targets.day+l,events:n,date:e})};u.prototype.render=function(){this.calendarContainer.children().remove();var e=this.createDaysObject(this.month);var t=this.month;var n={daysOfTheWeek:this.daysOfTheWeek,numberOfRows:Math.ceil(e.length/7),days:e,month:this.month.format("MMMM"),year:this.month.year(),eventsThisMonth:this.eventsThisMonth,eventsLastMonth:this.eventsLastMonth,eventsNextMonth:this.eventsNextMonth,extras:this.options.extras};if(!this.options.render){this.calendarContainer.html(this.compiledClndrTemplate(n))}else{this.calendarContainer.html(this.options.render.apply(this,[n]))}if(this.options.constraints){for(target in this.options.targets){if(target!=this.options.targets.day){this.element.find("."+this.options.targets[target]).toggleClass("inactive",false)}}var r=null;var i=null;if(this.options.constraints.startDate){r=moment(this.options.constraints.startDate)}if(this.options.constraints.endDate){i=moment(this.options.constraints.endDate)}if(r&&this.month.isSame(r,"month")){this.element.find("."+this.options.targets.previousButton).toggleClass("inactive",true)}if(i&&this.month.isSame(i,"month")){this.element.find("."+this.options.targets.nextButton).toggleClass("inactive",true)}if(r&&moment(r).subtract("years",1).isBefore(moment(this.month).subtract("years",1))){this.element.find("."+this.options.targets.previousYearButton).toggleClass("inactive",true)}if(i&&moment(i).add("years",1).isAfter(moment(this.month).add("years",1))){this.element.find("."+this.options.targets.nextYearButton).toggleClass("inactive",true)}if(r&&r.isAfter(moment(),"month")||i&&i.isBefore(moment(),"month")){this.element.find("."+this.options.targets.today).toggleClass("inactive",true)}}if(this.options.doneRendering){this.options.doneRendering.apply(this,[])}};u.prototype.bindEvents=function(){var t=e(this.element);var n=this;t.on("click","."+this.options.targets.day,function(t){if(n.options.clickEvents.click){var r=n.buildTargetObject(t.currentTarget,true);n.options.clickEvents.click.apply(n,[r])}if(n.options.adjacentDaysChangeMonth){if(e(t.currentTarget).is(".last-month")){n.backActionWithContext(n)}else if(e(t.currentTarget).is(".next-month")){n.forwardActionWithContext(n)}}});t.on("click","."+this.options.targets.empty,function(t){if(n.options.clickEvents.click){var r=n.buildTargetObject(t.currentTarget,false);n.options.clickEvents.click.apply(n,[r])}if(n.options.adjacentDaysChangeMonth){if(e(t.currentTarget).is(".last-month")){n.backActionWithContext(n)}else if(e(t.currentTarget).is(".next-month")){n.forwardActionWithContext(n)}}});t.on("click","."+this.options.targets.previousButton,{context:this},this.backAction).on("click","."+this.options.targets.nextButton,{context:this},this.forwardAction).on("click","."+this.options.targets.todayButton,{context:this},this.todayAction).on("click","."+this.options.targets.nextYearButton,{context:this},this.nextYearAction).on("click","."+this.options.targets.previousYearButton,{context:this},this.previousYearAction)};u.prototype.buildTargetObject=function(t,n){var r={element:t,events:[],date:null};if(n){var i;var s=t.className.indexOf("calendar-day-");if(s!==0){i=t.className.substring(s+13,s+23);r.date=moment(i)}else{r.date=null}if(this.options.events){if(this.options.multiDayEvents){r.events=e.makeArray(e(this.options.events).filter(function(){return(r.date.isSame(this._clndrStartDateObject,"day")||r.date.isAfter(this._clndrStartDateObject,"day"))&&(r.date.isSame(this._clndrEndDateObject,"day")||r.date.isBefore(this._clndrEndDateObject,"day"))}))}else{r.events=e.makeArray(e(this.options.events).filter(function(){return this._clndrDateObject.format("YYYY-MM-DD")==i}))}}}return r};u.prototype.forwardAction=function(e){var t=e.data.context;t.forwardActionWithContext(t)};u.prototype.backAction=function(e){var t=e.data.context;t.backActionWithContext(t)};u.prototype.backActionWithContext=function(e){if(e.element.find("."+e.options.targets.previousButton).hasClass("inactive")){return}var t=!e.month.isSame(moment(e.month).subtract("months",1),"year");e.month.subtract("months",1);e.render();if(e.options.clickEvents.previousMonth){e.options.clickEvents.previousMonth.apply(e,[moment(e.month)])}if(e.options.clickEvents.onMonthChange){e.options.clickEvents.onMonthChange.apply(e,[moment(e.month)])}if(t){if(e.options.clickEvents.onYearChange){e.options.clickEvents.onYearChange.apply(e,[moment(e.month)])}}};u.prototype.forwardActionWithContext=function(e){if(e.element.find("."+e.options.targets.nextButton).hasClass("inactive")){return}var t=!e.month.isSame(moment(e.month).add("months",1),"year");e.month.add("months",1);e.render();if(e.options.clickEvents.nextMonth){e.options.clickEvents.nextMonth.apply(e,[moment(e.month)])}if(e.options.clickEvents.onMonthChange){e.options.clickEvents.onMonthChange.apply(e,[moment(e.month)])}if(t){if(e.options.clickEvents.onYearChange){e.options.clickEvents.onYearChange.apply(e,[moment(e.month)])}}};u.prototype.todayAction=function(e){var t=e.data.context;var n=!t.month.isSame(moment(),"month");var r=!t.month.isSame(moment(),"year");t.month=moment().startOf("month");if(t.options.clickEvents.today){t.options.clickEvents.today.apply(t,[moment(t.month)])}if(n){t.render();t.month=moment();if(t.options.clickEvents.onMonthChange){t.options.clickEvents.onMonthChange.apply(t,[moment(t.month)])}if(r){if(t.options.clickEvents.onYearChange){t.options.clickEvents.onYearChange.apply(t,[moment(t.month)])}}}};u.prototype.nextYearAction=function(e){var t=e.data.context;if(t.element.find("."+t.options.targets.nextYearButton).hasClass("inactive")){return}t.month.add("years",1);t.render();if(t.options.clickEvents.nextYear){t.options.clickEvents.nextYear.apply(t,[moment(t.month)])}if(t.options.clickEvents.onMonthChange){t.options.clickEvents.onMonthChange.apply(t,[moment(t.month)])}if(t.options.clickEvents.onYearChange){t.options.clickEvents.onYearChange.apply(t,[moment(t.month)])}};u.prototype.previousYearAction=function(e){var t=e.data.context;if(t.element.find("."+t.options.targets.previousYear).hasClass("inactive")){return}t.month.subtract("years",1);t.render();if(t.options.clickEvents.previousYear){t.options.clickEvents.previousYear.apply(t,[moment(t.month)])}if(t.options.clickEvents.onMonthChange){t.options.clickEvents.onMonthChange.apply(t,[moment(t.month)])}if(t.options.clickEvents.onYearChange){t.options.clickEvents.onYearChange.apply(t,[moment(t.month)])}};u.prototype.forward=function(e){this.month.add("months",1);this.render();if(e&&e.withCallbacks){if(this.options.clickEvents.onMonthChange){this.options.clickEvents.onMonthChange.apply(this,[moment(this.month)])}if(this.month.month()===0&&this.options.clickEvents.onYearChange){this.options.clickEvents.onYearChange.apply(this,[moment(this.month)])}}return this};u.prototype.back=function(e){this.month.subtract("months",1);this.render();if(e&&e.withCallbacks){if(this.options.clickEvents.onMonthChange){this.options.clickEvents.onMonthChange.apply(this,[moment(this.month)])}if(this.month.month()===11&&this.options.clickEvents.onYearChange){this.options.clickEvents.onYearChange.apply(this,[moment(this.month)])}}return this};u.prototype.next=function(e){this.forward(e);return this};u.prototype.previous=function(e){this.back(e);return this};u.prototype.setMonth=function(e,t){this.month.month(e);this.render();if(t&&t.withCallbacks){if(this.options.clickEvents.onMonthChange){this.options.clickEvents.onMonthChange.apply(this,[moment(this.month)])}}return this};u.prototype.nextYear=function(e){this.month.add("year",1);this.render();if(e&&e.withCallbacks){if(this.options.clickEvents.onYearChange){this.options.clickEvents.onYearChange.apply(this,[moment(this.month)])}}return this};u.prototype.previousYear=function(e){this.month.subtract("year",1);this.render();if(e&&e.withCallbacks){if(this.options.clickEvents.onYearChange){this.options.clickEvents.onYearChange.apply(this,[moment(this.month)])}}return this};u.prototype.setYear=function(e,t){this.month.year(e);this.render();if(t&&t.withCallbacks){if(this.options.clickEvents.onYearChange){this.options.clickEvents.onYearChange.apply(this,[moment(this.month)])}}return this};u.prototype.setEvents=function(e){if(this.options.multiDayEvents){this.options.events=this.addMultiDayMomentObjectsToEvents(e)}else{this.options.events=this.addMomentObjectToEvents(e)}return this};u.prototype.addEvents=function(t){if(this.options.multiDayEvents){this.options.events=e.merge(this.options.events,this.addMultiDayMomentObjectsToEvents(t))}else{this.options.events=e.merge(this.options.events,this.addMomentObjectToEvents(t))}return this};u.prototype.addMomentObjectToEvents=function(e){var t=this;var n=0,r=e.length;for(n;n<r;n++){e[n]._clndrDateObject=moment(e[n][t.options.dateParameter])}return e};u.prototype.addMultiDayMomentObjectsToEvents=function(e){var t=this;var n=0,r=e.length;for(n;n<r;n++){e[n]._clndrStartDateObject=moment(e[n][t.options.multiDayEvents.startDate]);e[n]._clndrEndDateObject=moment(e[n][t.options.multiDayEvents.endDate])}return e};u.prototype.calendarDay=function(t){var n={day:"",classes:this.options.targets.empty,events:[],date:null};return e.extend({},n,t)};e.fn.clndr=function(e){if(this.length===1){if(!this.data("plugin_clndr")){var t=new u(this,e);this.data("plugin_clndr",t);return t}}else if(this.length>1){throw new Error("CLNDR does not support multiple elements yet. Make sure your clndr selector returns only one element.")}}})(jQuery,window,document)